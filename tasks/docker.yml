---
- name: Avi Controller | Docker | Check existing Docker container is running
  shell: docker ps -a | grep avinetworks/controller | grep -v CONTAINER
  ignore_errors: true
  changed_when: false
  failed_when: false
  register: con_docker_container_exists

- name: Avi Controller | Docker | Stop existing Avi Controller Docker container
  shell: docker stop `docker ps -a | grep avinetworks/controller | grep -v CONTAINER | awk '{printf "%s\\n",$1}'`
  when: con_docker_container_exists.rc == 0

- name: Avi Controller | Docker | Remove existing Avi Controller Docker container
  shell: docker rm -f `docker ps -a | grep avinetworks/controller | grep -v CONTAINER | awk '{printf "%s\\n",$1}'`
  when: con_docker_container_exists.rc == 0

- name: Avi Controller | Docker | Check for existing Avi Controller Docker image
  shell: docker images | grep avinetworks/controller
  ignore_errors: true
  changed_when: false
  failed_when: false
  register: con_docker_image_exists

- name: Avi Controller | Docker | Removing existing Avi Controller Docker images
  shell: docker rmi -f `docker images | grep avinetworks/controller | grep -v REPOSITORY | awk '{printf "%s\\n",$3}'`
  ignore_errors: true
  when: con_docker_image_exists.rc == 0

- name: Avi Controller | Docker | Deploy the Avi Controller image from the Package
  copy: src={{ package_source }} dest={{ package_dest }}
  when: package_deploy

- name: Avi Controller | Docker | Load the Avi Controller image from the Package
  shell: "docker load -i {{ package_dest }}"
  when: package_deploy

- name: Avi Controller | Docker | Load the Avi Controller image from Docker Hub
  shell: "docker pull {{ con_image }}"
  when: docker_repo == None and not package_deploy

- name: Avi SE | Docker | Load the Avi Controller image from custom Docker Repository
  shell: "docker pull {{ docker_repo }}/{{ con_image }}"
  when: docker_repo != None and not package_deploy
