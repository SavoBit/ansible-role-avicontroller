[Unit]
Description=AVICONTROLLER
After=docker.service
Requires=docker.service

[Service]
TimeoutStartSec=0
Restart=always

ExecStartPre=-/usr/bin/docker rm -f avicontroller
ExecStartPre=/usr/bin/docker run {{ docker_run_params }}
ExecStart=/usr/bin/docker wait avicontroller
ExecStop=-/usr/bin/docker stop avicontroller
{% if (netstat.rc == 0 and ip_addr.rc == 0) or (netstat.rc == 0 and ip_addr.rc == 1) %}
ExecStop=-/sbin/ifconfig {{ dev_name }}:1 down
{% elseif ip_addr.rc == 0 and netstat.rc == 1 %}
ExecStop=-/bin/bash -c "ip addr del $(ip addr | grep {{ dev_name }}:avivip | awk '{print $2}') dev {{ dev_name }}"
{% endif %}
ExecStopPost=-/usr/bin/docker rm -f avicontroller

[Install]
WantedBy=multi-user.target
